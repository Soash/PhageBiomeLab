{% extends "base.html" %}
{% load static %}
{% block styles %}
<style>
    .box-1{
        position: relative;
        height: 570px;
        width: 100%;
        display: flex;
        justify-content: space-around;
        align-items: end;
        gap: 10px;
    }
    /* Make carousel a background layer */
    #homepageCarousel {
        position: absolute;
        inset: 0;
        z-index: 0;
    }

    .box-1 .carousel-inner img {
        object-fit: cover;
    }
    .box-1::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(to bottom, rgba(0,0,0,.3), rgba(0,0,0,.6));
        z-index: 1;   /* <-- add this */
        pointer-events: none;
    }

    .box-2 {
        position: relative;
        z-index: 2;
        background: #1A76D1;
        height: 250px;
        width: 250px;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        
        /* animation: rise 0.6s ease-out forwards; */
        margin-bottom: 0;
        transform: translateY(50px);  /* pushes the cards outside the bottom */
    }
    .box-2 span:nth-child(2) {
        font-size: 50px;
    }
    @keyframes rise {
        0% { opacity: 0; transform: translateY(80px); }
        100% { opacity: 1; transform: translateY(40px); }
    }
    @media screen and (max-width: 840px) {
        .box-1{
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .box-2 {
            height: 100px;
            width: 300px;
            font-size: 10px;
        }
        .box-2 span:nth-child(2) {
            font-size: 25px;
        }
    }
    @media screen and (max-width: 400px) {
        .box-2 {
            height: 100px;
            width: 250px;
        }
    }
    .carousel-control-prev,
    .carousel-control-next {
        z-index: 3;      /* ensures buttons stay clickable */
    }
     
</style>
{% endblock %}
{% block content %}

<div class="box-1">

    <div id="homepageCarousel" class="carousel slide w-100 h-100" data-bs-ride="carousel">
        <div class="carousel-inner h-100">
            {% for img in slider_images %}
                <div class="carousel-item {% if forloop.first %}active{% endif %} h-100" data-bs-interval="3000">
                    <img src="{{ img.image.url }}" class="d-block w-100 h-100" style="object-fit: cover;">
                </div>
            {% endfor %}
        </div>

        <button class="carousel-control-prev" type="button" data-bs-target="#homepageCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#homepageCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <!-- Counters stay overlay on top -->
    <div class="box-2">
        <span>Ongoing Research Projects</span>
        <span class="counter" data-target="{{ ongoing_count }}">0</span>
    </div>
    <div class="box-2">
        <span>Total Publications</span>
        <span class="counter" data-target="{{ published_count }}">0</span>
    </div>
    <div class="box-2">
        <span>Total Research Projects</span>
        <span class="counter" data-target="{{ total_count }}">0</span>
    </div>

</div>




<div class="my-5 container">
    <div class="row">
        <div class="col-md-12 my-3">
            <div class="card p-4 p-md-5">
                <div class="row g-0">
                    <div class="col-md-3 d-flex align-items-center justify-content-center">
                        <img src="{{ about_us_image }}" 
                             class="img-fluid rounded" 
                             alt="{{ project.title }}">
                    </div>                    
                    <div class="col-md-9">
                        <div class="card-body">
                            <h3 class="card-title text-center text-primary mb-5"><b>About Us</b></h3>
                            <p class="card-text text-justify" id="description-{{ forloop.counter }}" 
                               data-desktop-length="50" 
                               data-mobile-length="30">
                               {{ about_us }} 
                            </p>
                            <a href="{% url 'members' %}" class="btn btn-primary mt-2">View All</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="my-5 container">
    <div class="row">
        <div class="col-md-12 my-3">
            <div class="card p-4 p-md-5">
                <div class="row g-0">
                    <div class="col-md-9">
                        <div class="card-body">
                            <h3 class="card-title text-center text-primary mb-5"><b>Ongoing Projects</b></h3>
                            <p class="card-text text-justify" id="description-{{ forloop.counter }}" 
                               data-desktop-length="50" 
                               data-mobile-length="30">
                                {{ ongoing }}
                            </p>
                            <a href="{% url 'ongoing_research' %}" class="btn btn-primary mt-2">View All</a>
                        </div>
                    </div>
                    <div class="col-md-3 d-flex align-items-center justify-content-center">
                        <img src="{{ ongoing_image }}" 
                             class="img-fluid rounded" 
                             alt="{{ project.title }}">
                    </div>  
                </div>
            </div>
        </div>
    </div>
</div>

<div class="my-5 container">
    <div class="row">
        <div class="col-md-12 my-3">
            <div class="card p-4 p-md-5">
                <div class="row g-0">
                    <div class="col-md-3 d-flex align-items-center justify-content-center">
                        <img src="{{ publication_image }}" 
                             class="img-fluid rounded" 
                             alt="{{ project.title }}">
                    </div>                    
                    <div class="col-md-9">
                        <div class="card-body">
                            <h3 class="card-title text-center text-primary mb-5"><b>Publications</b></h3>
                            <p class="card-text text-justify" id="description-{{ forloop.counter }}" 
                               data-desktop-length="50" 
                               data-mobile-length="30">
                               {{ publication }}
                            </p>
                            <a href="{% url 'published_research' %}" class="btn btn-primary mt-2">View All</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const truncateText = () => {
            const isMobile = window.innerWidth < 768;
            const descriptions = document.querySelectorAll(".card-text");
    
            descriptions.forEach((desc) => {
                const fullText = desc.dataset.original || desc.innerText.trim();
                const length = isMobile 
                    ? parseInt(desc.dataset.mobileLength) 
                    : parseInt(desc.dataset.desktopLength);
    
                if (!desc.dataset.original) {
                    desc.dataset.original = fullText;
                }
    
                const words = fullText.split(" ");
                if (words.length > length) {
                    const truncated = words.slice(0, length).join(" ");
                    desc.innerHTML = `${truncated} <span class="read-more" style="color: blue; cursor: pointer;">...read more</span>`;
                    
                    desc.querySelector(".read-more").onclick = () => {
                        desc.innerText = fullText;
                    };
                } else {
                    desc.innerText = fullText;
                }
            });
        };
    
        truncateText();
        window.addEventListener("resize", truncateText);
    });
</script>
    

<script>
// Function to animate the counter
const counters = document.querySelectorAll('.counter');

counters.forEach(counter => {
    counter.innerText = '0'; // Start at 0

    const updateCounter = () => {
        const target = +counter.getAttribute('data-target'); // Get the target number
        const current = +counter.innerText; // Get the current number

        if (current < target) {
            counter.innerText = Math.ceil(current + target / 100); // Increment the number
            setTimeout(updateCounter, 10); // Repeat until the target is reached
        } else {
            counter.innerText = target; // Ensure the number reaches the target
        }
    };

    updateCounter();
});

</script>
{% endblock %}